[id="deploying_contracts"]

= Deploying Starknet contracts

In this chapter, you will learn to compile, deploy and interact with a StarkNet contract written in Cairo.
Follow the below steps in order to accomplish your goal!

+++<strong>+++Step 1: Setting up account related environment variables +++</strong>+++

Type the following commands on your terminal in order to set the account related environment variables. You can use the default wallet provided by OpenZeppelin for ease of use.

[,Bash]
----
export STARKNET_NETWORK=alpha-goerli
export STARKNET_WALLET=starkware.starknet.wallets.open_zeppelin.OpenZeppelinAccount
----

+++<strong>+++Step 2:  Setting a new account for the tutorial +++</strong>+++

You need to make sure your starknet CLI is set up with a proper account contract, and funds. For safety, let us create a new one just for this chapter.


[,Bash]
----
#Generic Syntax
starknet new_account --account <name of the account>

#Create your new account named "test_v11"
starknet new_account --account test_v11
----

Once you have run the above command, monitor the transaction and wait until it has crossed the "Pending" state.
Then proceed with the below instructions. +

* You should get your expected contract address +
* Send 0.1 ETH to it +
* Monitor the transfer transaction. Once it has passed "pending", proceed +

Deploy your account once you have funded it with 0.1 ETH. You can either use the 
https://faucet.goerli.starknet.io[faucet] or bridge Goerli ETH from Ethereum to Starknet.

Account deployment command:

[,Bash]
----
starknet deploy_account --account test_v11
----

Your sample output should look something like this:

[,Bash]
----
(cairo_venv) gyan@Gnanas-MacBook-Pro .cairo % starknet deploy_account --account test_v11
Sending the transaction with max_fee: 0.000568 ETH (568383605914463 WEI).
Sent deploy account contract transaction.
Contract address: 0x03f42fc2355be54197a8b270ff2cb8e2eb7902e777b3498f8ad58c6c147cce60
Transaction hash: 0x3d15e05389ecd1ff65555220be57f0ab43729877b20ca086048276917ed2838
----

Monitor the transaction until it passes the "pending" state.

+++<strong>+++Step 3: Create, compile and deploy your contract+++</strong>+++

Before we get started, make sure that the below commands are working properly on your system:

[,Bash]
----
starknet --version
starknet-compile  --version
----

You can now create a folder of your choice where you would like to practice your cairo skills ðŸŽ¯. Inside the new folder, create a file name _hello_starknet.cairo_.

[,Bash]
----
#Create a new folder for practicing your cairo skills
cd ~/
mkdir cairo_practice && cd cairo_practice

#Create a new file called hello_starknet.cairo
touch hello_starknet.cairo
----

Copy paste the following piece of code into your hello_starknet.cairo file:

[,Bash]
----
#[contract]
    mod HelloStarknet {
        use starknet::get_caller_address;
        use starknet::ContractAddress;

        #[event]
        fn Hello(from:ContractAddress, value:felt252) {}

        #[external]
        fn Say_Hello(message:felt252) {
            letcaller=get_caller_address();
            Hello(caller, message);
        }

    }
----

Compile the above starknet contract using the following command:

[,Bash]
----
starknet-compile --hello_starknet.cairo hello_starknet.json --replace-ids 
----

The above command should compile to produce a hello_starknet.json in the same folder, however if the above command doesn't work, then here is an alternate approach to creating & compiling your cairo contracts.

+++<strong>+++Alternate Option+++</strong>+++

Instead of creating a new folder, work within the same .cairo/ folder that you had created while installing the cairo lang package. We will use cargo run to run the starknet-compile if it doesn't work out of the box on some systems.

[,Bash]
----
#cd into your .cairo folder
cd ~/.cairo

#Create the hello_starknet.cairo file in your .cairo folder and compile it
cargo run --bin starknet-compile -- hello_starknet.cairo hello_starknet.json --replace-ids

----

Now that you have your account ready from Step 3, letâ€™s declare your compiled contract and deploy it using the new account.

[,Bash]
----
starknet declare --contract hello_starknet.json --account test_v11
----

____
NOTE: If the declare command throws the following error: Error: OSError: [Errno 8] Exec format error: '/Users/gyan/cairo_venv/lib/python3.9/site-packages/starkware/starknet/compiler/v1/bin/starknet-sierra-compile' - then, you need to copy the starknet-sierra-compile from the .cairo folder to add it to the Python Libs using the following command:
[,Bash]
----
#Assuming that you are within the .cairo/ folder
cp target/release/starknet-sierra-compile ~/cairo_venv/lib/python3.9/site-packages/starkware/starknet/compiler/v1/bin/starknet-sierra-compile
----
____

____
NOTE: Once you have replaced the library, you can run the starknet declare command again and you should get a class hash as the output.
____

For example, a class hash that was deployed a while ago can be found on StarkScan https://testnet.starkscan.co/class/0x03ae6bb224f12a8818c3ad59cc248968e8ee3a3081ff805610141695381a28f7[here].

Using the above generated class hash, deploy the contract:

[,Bash]
----
starknet deploy --class_hash 0x03ae6bb224f12a8818c3ad59cc248968e8ee3a3081ff805610141695381a28f7 --account test_v11
----

____
NOTE: P.S: If you run into any fee related issues, please add the flag  --max_fee 100000000000000000 to your CLI commands.
____

Monitor the deploy transaction. Once it has passed "pending", proceed.

Wohooo! If all goes well, you have just deployed your first ever Cairo 1.0 contract on the StarkNet testnet! Congratulations.

+++<strong>+++Step 4: Interact with your contract+++</strong>+++

If you quickly browse through the above contract(hello_starknet.cairo), you can see, the contract has a simple function: Say_Hello which we are going to learn to invoke in this step.

[,Bash]
----

#Function that we will be invoking
#[external]
        fn Say_Hello(message:felt252) {
            letcaller=get_caller_address();
            Hello(caller, message);
        }
----

The syntax to invoke a function in your contract is:

[,Bash]
----
starknet invoke --function <name of the function> --address <address of the deployed contract> --max_fee 100000000000000000 --account <account_name>

#Invoking our Say_Hello function
starknet invoke --function Say_Hello --address 0x00e0309ca73c5097533ba200e08426b7efb3ee6b79ab6956bd4bb684d3385556 --input 152 --max_fee 100000000000000000  --account test_v11
----

Monitor the transaction. Once it has been accepted on L2, the first acceptance is indicated and once it has been accepted on L1, the tx has been added to Ethereum.


+++<strong>+++Step 5: Explore your transaction on StarkScan+++</strong>+++

Once your tx has been accepted on L2, you will be able to explore the events emitted and other details of your transaction on StarkNet block explorers like StarkScan.

https://testnet.starkscan.co/event/0x01093a8f548de7e7353f7b74ee85d9724a8c2874548dd57d89acc56dd750c8be_0[Here] is an example of the tx that I just invoked using the above command:

image::tx_invoke.png[Invoking a transaction]

If you switch to the events tab(example data in the image above), you should be able to see that the Event Data emitted is the caller and message(Index 0 and 1 respectively) as per the contract code. The caller is the address of the account that you created to deploy the contract and the message is the input that you have sent while invoking the _Say_Hello_ function.

== Contributing

ðŸŽ¯ +++<strong>+++STARKer: +++</strong>+++ This book is an open source effort, made possible only by contributions from readers like you. If you are interested in making this resource better for other users - please suggest a change by following the instructions https://github.com/starknet-edu/starknetbook/blob/main/CONTRIBUTING.adoc[here].
ðŸŽ¯